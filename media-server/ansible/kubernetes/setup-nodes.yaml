- hosts: all
  tasks:
  # install dependencies
    - name: Install packages
      apt:
        name:
          - curl
          - apt-transport-https
          - vim
          - git
          - wget

# add google repo

    - name: add google key
      ansible.builtin.apt_key:
        url: https://packages.cloud.google.com/apt/doc/apt-key.gpg 
        state: present

    - name: Add google repo
      ansible.builtin.apt_repository:
        repo: deb https://apt.kubernetes.io/ kubernetes-xenial main
        state: present

# install kubernetes
    - name: install kubernetes
      apt: 
        name: 
          - kubelet
          - kubeadm
          - kubectl
# Swapp off  

    - name: swapoff
      command: "swapoff -a"
      register: result

    - name: modprobe
      command: "modprobe overlay"

    - name: modprobe2
      command: "modprobe br.netfilter"
    
    #- name: swapoff
      #ansible.builtin.shell: tee /etc/sysctl.d/kubernetes.conf<<EOF
#net.bridge.bridge-nf-call-ip6tables = 1
#net.bridge.bridge-nf-call-iptables = 1
#net.ipv4.ip_forward = 1
#EOF